# Master makefile for RCS

# Copyright (C) 2010 Thien-Thi Nguyen
# Copyright (C) 1995 Paul Eggert
#
# This file is part of GNU RCS.
#
# GNU RCS is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 2 of the License, or
# (at your option) any later version.
#
# GNU RCS is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty
# of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
# See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

PACKAGE_VERSION = @PACKAGE_VERSION@
PACKAGE_TARNAME = @PACKAGE_TARNAME@

srcdir = @srcdir@
VPATH = @srcdir@

@SET_MAKE@
SHELL = /bin/sh

default :: all

standard_GNU_targets = \
	all install uninstall clean distclean mostlyclean maintainer-clean \
	TAGS info dvi check

maintainer-clean ::
	@echo "This command is intended for maintainers to use;"
	@echo "it deletes files that may require special tools to rebuild."

$(standard_GNU_targets) installcheck installdebug ::
	cd man && $(MAKE) $@
	cd src && $(MAKE) $@

dist :: $(srcdir)/configure
	cd man && $(MAKE) rcsfile.5
	cd src && $(MAKE) TAGS
	$(MAKE) distclean
	set -x && \
	d='$(PACKAGE_TARNAME)-$(PACKAGE_VERSION)' && \
	rm -fr $$d && \
	mkdir $$d $$d/build-aux $$d/man $$d/src && \
	ln *.ms ChangeLog configure configure.in AUTHORS COPYING \
		INSTALL \
		Makefile.in NEWS README $$d && \
	(cd build-aux && ln extract-help \
		install-sh mkinstalldirs \
		../$$d/build-aux) && \
	(cd man && ln ChangeLog Makefile.in ../$$d/man && \
		{ echo '.ds Rv $(PACKAGE_VERSION)' ; \
		  date -u +'.ds Dt %Y-%m-%d' ; } > TMP ; \
		for f in *.[0-9] *.[0-9]in ; do \
		  cat TMP $$f > ../$$d/man/$$f ; \
		done ; \
		rm -f TMP) && \
	(cd src && ln *.[ch] *.sh ChangeLog \
		Makefile.in rcstest TAGS ../$$d/src) && \
	sed -i 's/PACKAGE_VERSION/$(PACKAGE_VERSION)/' \
	  $$d/src/rcsfreeze.sh && \
	tar -cf - $$d | gzip -9 >$$d.tar.gz && \
	rm -fr $$d

$(srcdir)/configure : configure.in
	cd $(srcdir) && autoconf

config.status : configure
	./config.status --recheck

Makefile : Makefile.in config.status
	./config.status

clean :: clean.
clean. ::
	rm -f confdefs* conftest* core core.* *.core

distclean maintainer-clean :: distclean.
distclean. :: clean.
	rm -f Makefile config.cache config.log config.status
