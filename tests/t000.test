# t000.test                                             -*- shell-script -*-

. ./common
split_std_out_err no

w=$wd/x
v=$wd/x,v

# Initialize empty RCS file.
do_and_show 'rcs -i -t-t000 $v' ; do_rlog ; cp $v ${v}SAVE
# Add a revision.
echo nonempty > $w
do_and_show 'ci -u -r4.20 -mHELLO $w'
# Outdate it.
do_and_show 'rcs -q -o4.20 $w' ; do_rlog | tee $wd/last-rlog

# We expect the RCS file to be empty again.
grep 'total revisions: 0' $wd/last-rlog \
    && cmp $v ${v}SAVE \
    && test -z "$(co -q -p $v)" \
    || exit 1

# Add a revision.
co -l $w
echo nonempty > $w
do_and_show 'ci -u -r4.20 -mHELLO $w'
# Add another
do_and_show 'co -l $w'
echo morejunk >> $w
do_and_show 'ci -u -mANOTHER $w'
# Outdate the first one, but not the second.
do_and_show 'rcs -q -o4.20 $w' ; do_rlog | tee $wd/last-rlog

# We expect the RCS file to have only the second revision/log.
grep 'total revisions: 1' $wd/last-rlog \
    && grep '^@ANOTHER' $v \
    && { if grep '^@HELLO' $v ; then false ; else true ; fi ; } \
    || exit 1

# t000.test ends here
